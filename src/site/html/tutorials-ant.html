<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <body>
    <div class="container box">
      <h1 class="page-header">Apache Ant tutorial <small>Run tests with Apache Ant</small></h1>
      
      <p>
        In this how-to tutorial I will use Apache Ant to manage a Citrus project and we will use Ant to execute Citrus test cases. First of all
        I loaded the latest <a href="download.html">Citrus release archive</a> to an empty folder on my local storage.
        Unzip the archive in order to have access to the Citrus binaries and sources.
      </p>
      
      <p><b>Preconditions</b></p>

      <p>
        Before we start lets check that you have the proper software installed on your computer, in order to use Citrus:
      </p>
      
      <ul>
        <li>
          Java 7 or higher<br />Installed JDK plus
          JAVA_HOME environment variable set up and pointing to your Java
          installation directory
        </li>
        <li>
          Java IDE<br />A Java IDE will help you manage your
          Citrus project, create and execute test cases. Just use the Java IDE that
          you are used to (e.g. <a href="http://www.eclipse.org/">Eclipse</a> 
          or <a href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a>).
        </li>
        <li>
          Ant 1.8 or higher<br />Citrus tests will be executed with the <a href="http://ant.apache.org/">Apache Ant</a> 
          build tool. But it is not required to use Ant only. You can also run tests via <a href="http://http://maven.apache.org/">Maven</a> 
          for example.
        </li>
      </ul>
      
      <p>
        So now lets start to set up a new Citrus Java project. In contrast to a Maven generated project we have to create our project structure 
        ourself when using Ant. A good starting point is the samples folder coming with the Citrus release distribution. Here you can see several
        sample Citrus projects with given folder structure. So lets have a look at a usual Citrus project structure. I am using the <a href="http://www.eclipse.org/">Eclipse
        IDE</a> development tool to set up the new Java project. I am also accessing Ant from the command line in this tutorial so you may also 
        want to install Ant first before continuing. See the <a href="http://ant.apache.org/">Ant homepage</a> for detailed installation 
        instructions.
      </p>
      
      <p>Have a look at the folder structure I created for our new Citrus project</p>
    
      <img alt="Project explorer" src="images/tutorials/ant/project_explorer.png"/>
            
      <p>
        I created a simple Java project in Eclipse called <i>&quot;citrus-sample&quot;</i>. I manually added folders and files to the project
        as follows. The Citrus project knows three source folders, that are also added to the Java build path as source 
        folders:
      </p>  
      
      <ul>
          <li><b>src/citrus/java:</b> Storage for generated Java TestNG tests</li>
          <li><b>src/citrus/resources:</b> Configuration files go in here (e.g. Spring application context files, citrus.properties, log4j.xml, ...)</li>
          <li><b>src/citrus/tests:</b> XML test case describing files (generated by Citrus)</li>
      </ul>
      
      <p>
        As a next step we setup a <i>lib</i> folder for some libraries we need for execution. This includes the Citrus Java
        archives (citrus-core.jar, citrus-http.jar, etc.) coming from the <a href="download.html">downladed release archive</a> and all
        dependency libraries also available in the release archive. Finally what's missing is the Ant build file (build.xml) with following content.
      </p>
      
      <pre class="prettyprint linenums">&lt;project name=&quot;citrus-sample&quot; basedir=&quot;.&quot; default=&quot;citrus.run.tests&quot; xmlns:artifact=&quot;antlib:org.apache.maven.artifact.ant&quot;&gt;
  
    &lt;property file=&quot;src/citrus/resources/citrus.properties&quot;/&gt;
    
    &lt;path id=&quot;maven-ant-tasks.classpath&quot; path=&quot;lib/maven-ant-tasks-2.1.3.jar&quot; /&gt;
    &lt;typedef resource=&quot;org/apache/maven/artifact/ant/antlib.xml&quot;
             uri=&quot;antlib:org.apache.maven.artifact.ant&quot;
             classpathref=&quot;maven-ant-tasks.classpath&quot; /&gt;

    &lt;artifact:pom id=&quot;citrus-pom&quot; file=&quot;pom.xml&quot; /&gt;
    &lt;artifact:dependencies filesetId=&quot;citrus-dependencies&quot; pomRefId=&quot;citrus-pom&quot; /&gt;

    &lt;path id=&quot;citrus-classpath&quot;&gt;
      &lt;pathelement path=&quot;src/citrus/java&quot;/&gt;
      &lt;pathelement path=&quot;src/citrus/resources&quot;/&gt;
      &lt;pathelement path=&quot;src/citrus/tests&quot;/&gt;
      &lt;fileset refid=&quot;citrus-dependencies&quot;/&gt;
    &lt;/path&gt;

    &lt;taskdef resource=&quot;testngtasks&quot; classpath=&quot;lib/testng-6.8.8.jar&quot;/&gt;
    
    &lt;target name=&quot;compile.tests&quot;&gt;
        &lt;javac srcdir=&quot;src/citrus/java&quot; classpathref=&quot;citrus-classpath&quot;/&gt;
        &lt;javac srcdir=&quot;src/citrus/tests&quot; classpathref=&quot;citrus-classpath&quot;/&gt;
    &lt;/target&gt;
  
    &lt;target name=&quot;create.test&quot; description=&quot;Creates a new empty test case&quot;&gt;
        &lt;input message=&quot;Enter test name:&quot; addproperty=&quot;test.name&quot;/&gt;
        &lt;input message=&quot;Enter test description:&quot; addproperty=&quot;test.description&quot;/&gt;
        &lt;input message=&quot;Enter author's name:&quot; addproperty=&quot;test.author&quot; defaultvalue=&quot;${default.test.author}&quot;/&gt;
        &lt;input message=&quot;Enter package:&quot; addproperty=&quot;test.package&quot; defaultvalue=&quot;${default.test.package}&quot;/&gt;
        &lt;input message=&quot;Enter framework:&quot; addproperty=&quot;test.framework&quot; defaultvalue=&quot;testng&quot;/&gt;

        &lt;java classname=&quot;com.consol.citrus.util.TestCaseCreator&quot;&gt;
            &lt;classpath refid=&quot;citrus-classpath&quot;/&gt;
            &lt;arg line=&quot;-name ${test.name} -author ${test.author} -description ${test.description} -package ${test.package} -framework ${test.framework}&quot;/&gt;
        &lt;/java&gt;
    &lt;/target&gt;
    
    &lt;target name=&quot;citrus.run.tests&quot; depends=&quot;compile.tests&quot; description=&quot;Runs all Citrus tests&quot;&gt;
        &lt;testng classpathref=&quot;citrus-classpath&quot;&gt;
          &lt;classfileset dir=&quot;src/citrus/java&quot; includes=&quot;**/*.class&quot; /&gt;
        &lt;/testng&gt;
    &lt;/target&gt;

    &lt;target name=&quot;citrus.run.single.test&quot; depends=&quot;compile.tests&quot; description=&quot;Runs a single test by name&quot;&gt;
        &lt;touch file=&quot;test.history&quot;/&gt;
        &lt;loadproperties srcfile=&quot;test.history&quot;/&gt;

        &lt;echo message=&quot;Last test executed: ${last.test.executed}&quot;/&gt;
        &lt;input message=&quot;Enter test name or leave empty for last test executed:&quot; addproperty=&quot;testclass&quot; defaultvalue=&quot;${last.test.executed}&quot;/&gt;

        &lt;propertyfile file=&quot;test.history&quot;&gt;
            &lt;entry key=&quot;last.test.executed&quot; type=&quot;string&quot; value=&quot;${testclass}&quot;/&gt;
        &lt;/propertyfile&gt;

        &lt;testng classpathref=&quot;citrus-classpath&quot;&gt;
          &lt;classfileset dir=&quot;src/citrus/java&quot; includes=&quot;**/${testclass}.class&quot; /&gt;
        &lt;/testng&gt;
    &lt;/target&gt;
    
&lt;/project&gt;</pre>
      
      <p>
        Those who are familiar with Ant will understand this file easily. We used the maven ant tasks in order to download all 3rd party libraries needed for a Citrus run. You need to setup the
        Maven Ant tasks JAR and the TestNG JAR in the lib directory before executing the build script for the first time.
        Further a Java classpath is defined with its conventional name <i>&quot;citrus-classpath&quot;</i>. The classpath definition includes all Java libraries found inside the lib folder. Besides that the
        build file declares the TestNG special Ant tasks that help us to execute the tests.
      </p>
      
      <p>
        These TestNG Ant task definitions will help to execute Citrus out of a Ant build script. We will handle the execution later in this tutorial in more detail. For now we will start with the
        <i>&quot;create.test&quot;</i> target. This target creates new test cases for your project. So let us give it a try! I execute the 
        &quot;create.test&quot; target from the command line using my seperate Ant installation. To be honest it is more comfortable to use the 
        built-in Eclipse Ant plugin to execute Ant targets, but I choose the command line first to be more independent from the IDE tool.
      </p>
      
      <p>
        The target will prompt for some information when executed, see the output below:
      </p>
      
      <pre>$ ant create.test
Buildfile: build.xml

create.test:
    [input] Enter test name: MyFirstTest
    [input] Enter test description: This is my first Citrus test
    [input] Enter author's name: [Christoph]
    [input] Enter package: [com.consol.citrus.ant.sample]
    [input] Enter framework: [testng]

BUILD SUCCESSFUL
Total time: 21 seconds</pre>
      
      <p>
        The target will ask you for the name of the test first. After that you give a description for the test. The author's default name is 
        located in the <i>&quot;citrus.properties&quot;</i>, but you can also specify another author of course. Same thing with the test's package. 
        In the <i>&quot;citrus.properties&quot;</i> you can define a default package or you can type in another package when prompted.
      </p>
      
      <p>
        Now that we have given all information for the test Citrus will create all test files automatically. Let us have a look at the 
        generated files.
      </p>
      
      <img alt="Created test files" src="images/tutorials/ant/created_test_files.png"/>
      
      <p>The generated files are:</p>
      <ul>
          <li><b>src/citrus/java/MyFirstTest.java:</b> TestNG Java test case that is executable right now</li>
          <li><b>src/citrus/tests/MyFirstTest.xml:</b> Citrus XML test case describing file</li>
      </ul>
      
      <p>With these two files you are able to run the test. Let us first have a look at the generated XML test description:</p>
      
      <pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;spring:beans xmlns=&quot;http://www.citrusframework.org/schema/testcase&quot; 
                 xmlns:spring=&quot;http://www.springframework.org/schema/beans&quot; 
                 xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; 
                 xsi:schemaLocation=&quot;
                 http://www.springframework.org/schema/beans 
                 http://www.springframework.org/schema/beans/spring-beans.xsd 
                 http://www.citrusframework.org/schema/testcase 
                 http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd&quot;&gt;
                 
    &lt;testcase name=&quot;MyFirstTest&quot;&gt;
        &lt;meta-info&gt;
            &lt;author&gt;Christoph&lt;/author&gt;
            &lt;creationdate&gt;2009-08-19&lt;/creationdate&gt;
            &lt;status&gt;DRAFT&lt;/status&gt;
            &lt;last-updated-by&gt;Christoph&lt;/last-updated-by&gt;
            &lt;last-updated-on&gt;2009-08-19T11:18:06&lt;/last-updated-on&gt;
        &lt;/meta-info&gt;
        
        &lt;description&gt;This is my first Citrus test&lt;/description&gt;
        
        &lt;actions&gt;
            &lt;echo&gt;
                &lt;message&gt;TODO: Code the test MyFirstTest&lt;/message&gt;
            &lt;/echo&gt;
        &lt;/actions&gt;
    &lt;/testcase&gt;
&lt;/spring:beans&gt;</pre>
      
      <p>
        Citrus created an empty test case that does nothing but print a simple message to the console. The test is in status &quot;DRAFT&quot; 
        which means it is not finished yet but be aware that the test is executable in this state. In case you need to disable the test
        because it is not entirely finished yet and may cause failures in a test run you can use the status DISABLED. You may code the test first 
        and then change its status to &quot;FINAL&quot; in order to finally enable the test for execution. Right now we do not want to code any additional 
        logic into the test case for this tutorial, so we change its status right now to &quot;FINAL&quot; and try to execute the test with Ant.
      </p>
      
      <p>
        We switch again to the command line to execute the Ant target called <i>&quot;citrus.run.single.test&quot;</i>. We are asked to type 
        in the name of the test to execute. In our example we type <i>&quot;MyFirstTest&quot;</i> and Citrus will execute the test.
      </p>
      
      <pre>$ ant citrus.run.single.test
Buildfile: build.xml

citrus.run.single.test:
[echo] Last test executed: Unknown
[input] Enter test name: [Unknown] MyFirstTest

CITRUS TESTFRAMEWORK

Found test 'com.consol.citrus.ant.sample.MyFirstTest'

RUNNING CITRUS TESTS

------------------------------------------------------------------------
INIT

Found 0 tasks in init phase
------------------------------------------------------------------------
INIT successfully

------------------------------------------------------------------------
STARTING TEST: MyFirstTest
Initializing TestCase
TestCase using the following global variables:
project.name = Citrus sample

1. action in test chain
echo TODO: Code the test MyFirstTest

TEST FINISHED: MyFirstTest
------------------------------------------------------------------------
FINISH CITRUS TEST
------------------------------------------------------------------------
________________________________________________________________________

CITRUS TEST RESULTS

  MyFirstTest                                       : SUCCESS

Found 1 test cases to execute
Skipped 0 test cases (0.0%)
Executed 1 test cases
Tests failed:            0 (0.0%)
Tests successfully:      1 (100.0%)
________________________________________________________________________
Found 0 tasks after
------------------------------------------------------------------------
FINISH successfully</pre>
      
      <p>
        The execution by test names only is suitable for executing a small amount of test cases. If you want to run a whole package of tests use
        the package notation instead as it is used in the <i>&quot;citrus.run.tests&quot;</i> target which executes all tests in the package &quot;com.consol.citrus&quot;.
      </p>
      
      <p>
        The last option you have when executing Citrus is a TestNG suite xml file. TestNG can configure test suites via XML. We have a look at a very
        simple testng.xml.
      </p>
      
      <pre class="prettyprint linenums">&lt;!DOCTYPE suite SYSTEM &quot;http://testng.org/testng-1.0.dtd&quot;&gt;
&lt;suite name=&quot;citrus-samples&quot;&gt;
  &lt;test verbose=&quot;2&quot; name=&quot;com.consol.citrus.ant.sample.MyFirstTest&quot; annotations=&quot;JDK&quot;&gt;
    &lt;classes&gt;
      &lt;class name=&quot;com.consol.citrus.ant.sample.MyFirstTest&quot;/&gt;
    &lt;/classes&gt;
  &lt;/test&gt;
&lt;/suite&gt;</pre>
      
      <p>
        The testng.xml is very powerful and you have a lot of options how to group tests together to suites. Citrus can work on those testng.xml
        files when executed with Ant.
      </p>
      
      <pre class="prettyprint linenums">&lt;testng&gt;
  &lt;xmlfileset dir=&quot;configuration&quot; includes=&quot;testng.xml&quot;/&gt;
&lt;/testng&gt;</pre>
      
      <p>
        That's it! This is how Citrus connects with a normal Eclipse Java project and Ant. With Ant you can integrate your Citrus tests easily
        in your continuous build environment, so the tests are executed every time something has changed in the code base of your project. 
      </p>
      
    </div>
  </body>
</html>
